USE master
IF EXISTS (SELECT * FROM SYSDATABASES WHERE NAME = 'ManagerStudent')
			Drop database ManagerStudent
			
CREATE DATABASE ManagerStudent
go
use ManagerStudent

CREATE TABLE KHOA (
	MaKhoa CHAR(4) PRIMARY KEY,
	TenKhoa NVARCHAR(30),
);
CREATE TABLE KHOAHOC(
	MaKH INT NOT NULL IDENTITY(1,1) Primary key,
	TenKH NVARCHAR(30),
);
CREATE TABLE TINHTRANGHOC(
	ID_Status INT NOT NULL IDENTITY(1,1) Primary key,
	TinhTrang NVARCHAR(30),
);
CREATE TABLE SINHVIEN (
	MaSV CHAR(10) not null PRIMARY KEY,
	HoTen NVARCHAR(50),
	GioiTinh BIT,
	DiaChi NVARCHAR(100),
	NienKhoa CHAR(9),
	CMND CHAR(12),
	SoDienThoai CHAR(10),
	Email VARCHAR(MAX),
	NgaySinh DATE,
	MatKhau VARCHAR(MAX),
	MaKhoa CHAR(4),
	MaKH INT NOT NULL,
	ID_Status INT NOT NULL,
	CONSTRAINT FK_SV_K FOREIGN KEY (MaKhoa)
	REFERENCES KHOA (MaKhoa),
	CONSTRAINT FK_SV_KH FOREIGN KEY (MaKH)
	REFERENCES KHOAHOC (MaKH),
	CONSTRAINT FK_SV_TT FOREIGN KEY (ID_Status)
	REFERENCES TINHTRANGHOC (ID_Status)
)


CREATE TABLE MONHOC(
	MaMH INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	TenMH NVARCHAR(50),
	SoTinChi INT,
	MaKhoa CHAR(4),
	CONSTRAINT FK_MH_K FOREIGN KEY (MaKhoa)
	REFERENCES KHOA(MaKhoa)
)


CREATE TABLE GIANGVIEN(
	MaGV CHAR(4) PRIMARY KEY,
	HoTen NVARCHAR(50),
	GioiTinh BIT,
	SoDienThoai CHAR(10),
	Email CHAR(30),
	ChucVu NVARCHAR(20),
	MatKhau VARCHAR(MAX),
	NgaySinh DATE,
	NgayVaoLam DATE,
	DiaChi NVARCHAR(50),
	MaKhoa CHAR(4),
	CONSTRAINT FK_GV_K FOREIGN KEY (MaKhoa)
	REFERENCES KHOA (MaKhoa),
)
CREATE TABLE LOPHOCPHAN(
	MaLHP CHAR(4) PRIMARY KEY,
	TenLHP NVARCHAR(50),
	CaHoc INT,
	Siso INT,
	HK INT,
	MaGV CHAR(4),
	MaMH INT NOT NULL,
	CONSTRAINT FK_LHP_MH FOREIGN KEY (MaMH)
	REFERENCES MONHOC (MaMH),
	CONSTRAINT FK_LHP_GV FOREIGN KEY (MaGV)
	REFERENCES GIANGVIEN (MaGV)
)
CREATE TABLE Diem(
	MaSV CHAR(10) not null,
	MaLHP CHAR(4),
	DiemChuyenCan INT,
	DiemGiuaKy INT,
	DiemCuoiKy INT,
	CONSTRAINT PK_DK PRIMARY KEY (MaSV, MaLHP),
	CONSTRAINT FK_DK_SV FOREIGN KEY (MaSV)
	REFERENCES SINHVIEN (MaSV),
	CONSTRAINT FK_DK_LHP FOREIGN KEY (MaLHP)
	REFERENCES LOPHOCPHAN (MaLHP)
)
CREATE TABLE ADMIN_ACCOUNT(
	MaAd CHAR(5) PRIMARY KEY,
	MatKhau VARCHAR(MAX)
)

INSERT INTO ADMIN_ACCOUNT VALUES('admin','123')

CREATE TABLE LICHHOC (
	MaSV CHAR(10) NOT NULL,               -- Student ID
	MaLHP CHAR(4) NOT NULL,               -- Class ID
	NgayHoc TINYINT NOT NULL,             -- Day of the week (1 = Monday, 2 = Tuesday, ..., 7 = Sunday)
	GioBatDau TIME NOT NULL,              -- Start time
	GioKetThuc TIME NOT NULL,             -- End time
	CONSTRAINT PK_LICH PRIMARY KEY (MaSV, MaLHP, NgayHoc),
	CONSTRAINT FK_LICHSV FOREIGN KEY (MaSV)
	REFERENCES SINHVIEN (MaSV),
	CONSTRAINT FK_LICHLHP FOREIGN KEY (MaLHP)
	REFERENCES LOPHOCPHAN (MaLHP)
);

CREATE TABLE ENROLLMENT (
	MaSV CHAR(10) NOT NULL,               -- Student ID
	MaLHP CHAR(4) NOT NULL,               -- Class Section ID
	CONSTRAINT PK_ENROLLMENT PRIMARY KEY (MaSV, MaLHP),
	CONSTRAINT FK_ENROLLMENT_SV FOREIGN KEY (MaSV)
	REFERENCES SINHVIEN (MaSV),
	CONSTRAINT FK_ENROLLMENT_LHP FOREIGN KEY (MaLHP)
	REFERENCES LOPHOCPHAN (MaLHP)
);

